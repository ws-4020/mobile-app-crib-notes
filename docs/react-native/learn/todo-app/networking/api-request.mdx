---
title: REST APIの呼びだし
---

ToDoアプリからREST APIを呼び出して、サーバから取得したデータを画面に表示していきましょう。まずは、`TodoService`でAPIクライアントを使うように修正します。

## `TodoService`の修正

`TodoService`の各メソッドから、適切なAPIクライアントのメソッドを呼びだすように修正していきます。

共通的な設定をしている`config`と自動生成された`TodosApi`を`backend`からimportします。

```typescript title="src/service/TodoService.ts"
import {TodosApi, config} from 'backend';
```

次に`TodosApi`のインスタンスを作成し、`TodoService`のメソッドから呼びだすように修正します。
`TodosApi`に`config`を渡すことで、接続先を切り替えられるようにします。
`TodoService`の3つのメソッドを以下のように修正してください。

```typescript
const todosApi = new TodosApi(config);

const getTodos = async () => {
  return await todosApi.getTodos();
};

const postTodo = async (text: string) => {
  return await todosApi.postTodo({newTodo: {text}});
};

const putTodo = async (id: number, completed: boolean) => {
  return await todosApi.putTodo({todoId: id, todoStatus: {completed}});
};
```

メソッドを修正すると`TodoService`のダミーデータである`todos`と`id`が不要になるので削除します。
削除すると`TodoService`は以下のような実装になります。

```typescript title="src/service/TodoService.ts"
import {TodosApi, config} from 'backend';

const todosApi = new TodosApi(config);

const getTodos = async () => {
  return await todosApi.getTodos();
};

const postTodo = async (text: string) => {
  return await todosApi.postTodo({newTodo: {text}});
};

const putTodo = async (id: number, completed: boolean) => {
  return await todosApi.putTodo({todoId: id, toDoStatus: {completed}});
};

export const TodoService = {
  getTodos,
  postTodo,
  putTodo,
};
```

## 動作確認

これでToDoアプリから登録したToDoが保存され、アプリを再起動しても、前に登録したToDoが参照できるようになりました。

<!--
TODO: APIサーバを再起動したらデータが消えるなら、ここで説明しておく必要あるね。
-->

実際に、そのようになっていることを確認していきましょう。次の手順でアプリを操作してください。

> 🚧 作成中 🚧

<!--
TODO: 起動+ログイン => 一覧① => 登録 => 完了 => アプリ閉じる => 起動+ログイン => 一覧②
      一覧①: 空（全てを選択しても何も表示されない）
      一覧②: 完了しているToDoが１件ある
-->

また、自分で起動しているアプリ以外から登録されたデータも参照できるようになっています。次の手順を実施して、他の人がToDoを追加したときの動作を確認してみましょう。

> 🚧 作成中 🚧

<!--
TODO: 起動+ログイン => 一覧① => 登録 => 完了 => curlなどでToDo追加 => 設定 => 一覧②
      一覧①: 空（全てを選択しても何も表示されない）
      一覧②: 完了しているToDoが１件と、curlで追加したToDoがある
-->

これで、REST APIを呼び出せるようになりました。しかし、このままではAPIを呼び出している間も画面が操作可能のままになってしまいますし、ユーザにアプリが処理中であることを伝えられません。

そこで、次はAPIの呼び出し中に画面の一部を操作不可にし、ユーザに処理中であることを伝えるインジケータを表示するように修正します。
