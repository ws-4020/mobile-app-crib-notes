---
title: REST API呼びだし中の表示
---

REST APIの呼びだしには少し時間がかかるものです。呼びだし中に何もフィードバックを返さないと、アプリで処理中なのか、自分の操作が伝わっていないのか、ユーザには判断できなくなってしまいます。そのため、REST APIの呼びだし中は、アプリが処理中であることをユーザに伝えるのが望ましいです。

また、削除したToDoの編集など、REST APIでの処理が完了するまでブロックしたい操作もあります。

ToDoアプリでは、REST APIの呼びだし中はToDo一覧上に、ローディング中であることを伝えるアクティビティインジケーターを表示します。また、ToDo一覧内での完了や編集などの操作をブロックします。

これから学習して実装して表現するローディング中状態は以下になります。

![Image](../app-hands-on/ios-wait.png)

## REST APIの呼びだし状態の管理

まず、REST APIを呼びだすコンポーネントで、REST APIを呼びだし中かどうかを管理します。状態の管理には、Reactのステートを利用します。
ステートとは、コンポーネントの状態を表すデータ（状態）を指します。今回はステートを利用してREST APIの処理状態を更新したり、参照したりする際に利用します。

> 🚧 作成中 🚧

<!--
TODO: Hooksの説明はいらないっけ。ステートはここまでほとんど触れてない気もするから、書いてあげたほうがいい気がする。
-->

:::caution
現時点では、エラー発生時の処理は実装しませんが、実装中にどのようなエラーが発生しているかを確認したいことは多いのでログ出力だけしています。

本来は、エラーが発生した場合にはユーザにもエラーの内容と（可能であれば）エラーから回復する方法を伝えるべきです。
:::

## アクティビティインジケータの表示

次に、REST APIを呼び出している間だけアクティビティインジケータを表示するように修正します。このとき、アクティビティインジケータを表示するコンポーネントをToDo一覧の上にかぶせて表示することで、ToDo一覧内でのユーザの操作をブロックします。

> 🚧 作成中 🚧

<!--
TODO: ステートを参照して、表示するかどうかを切り替えることと、下に配置すると上に表示されるから操作をブロックできることを伝えられれば良いだろうか。
-->

## 動作確認

これで、ToDo一覧取得のREST APIを呼びだしている間はアクティビティインジケータが表示され、一部の操作はブロックされるようになりました。実際にアプリを起動して動きを確認しましょう。

ただ、APIサーバをローカルホストで起動している場合などは、REST APIからの応答が早いため一瞬しかアクティビティインジケータが表示されません。この状態だとアクティビティインジケータの確認は難しいので、まずREST APIからの応答に時間がかかっている状況を擬似的に再現します。

> 🚧 作成中 🚧

<!--
TODO: ここでMiddlewareの話をして、APIクライアントからのレスポンスを遅延させるようにしてみる。
-->

このように修正すると、`TodoService`でToDo一覧などを取得するまでにxx秒かかるようになります。なので、その間アクティビティインジケータが表示され、xx秒経つとインジケータが消えることを確認しましょう。

> 🚧 作成中 🚧

<!--
TODO: 動作確認の手順を何パターンか提示しておくのがいいかな。「アプリ起動後」「タブ切替時」「ToDo登録後」くらいで充分かな？
-->
