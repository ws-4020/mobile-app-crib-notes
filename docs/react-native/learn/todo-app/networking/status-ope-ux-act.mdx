---
title: ユーザー操作への応答
---

ToDo一覧が表示されたらToDoのステータス完了までの応答速度を改善してみましょう。

現状、ToDoのステータスをタップしてもすぐに変更されず、応答が返ってくるまでユーザは待つ必要があります。
ToDo一覧の最新化と同じように処理が終わるまで操作をブロックしても良いですが、連続してToDoのステータスを変更するときに、かなりのストレスになります。

ここではToDoのステータスがタップされたタイミングでUIを変更するようにしましょう。

## ToDoステータスをタップしたタイミングで更新

次のようにREST APIを呼びだす前にタップして更新したステータスを`updateTodo`で受け取ります。

その後、`setTodos`へステータス更新した結果を反映するように修正します。

```diff typescript title="screens/todo/TodoBoard.tsx"
export const TodoBoard: React.FC = () => {

    const toggleTodoCompletion = useCallback(

         // 中略

+        const updateTodo = {...target, completed: !target.completed};
-        setTodos(todos.map((todo) => (todo.id === id ? {...todo, completed: !target.completed} : todo)));
+        setTodos(todos.map((todo) => (todo.id === id ? updateTodo : todo)));
        TodoService.putTodo(id, !target.completed)
        .then((returnedTodo) =>
            setTodos((prevTodos) => {
                return prevTodos.map((todo) => (todo.id === id ? returnedTodo : todo));
            }),
        )
        .catch(() => {});

        // 中略

    );
```

:::note
REST APIが正常に処理出来なかった場合にUIを戻す必要がありますが、その方法についてはガイドしません。
catchブロックで「ユーザにエラーを伝え」、「ToDo一覧」を操作前、もしくは最新化するという方法を考えてみてください。
:::

## 動作確認

これでToDoのステータスをタップしたタイミングでUIへ反映されるようになりました。

実際にアプリを次の手順で動かして、確認していきましょう。

1. APIサーバを起動
2. アプリを起動
3. ログイン
4. 任意のToDoのステータスをタップする（複数個）

タップしたToDoのステータスがすぐに反映されることが確認できます。
