---
title: プッシュ通知の受信
---

iOSアプリの場合はAPNsから、Androidアプリの場合はATLからそれぞれプッシュ通知を受信します。

プッシュ通知を受信した際、アプリの状態により通知の取り扱いが変わります。
アプリの状態には次のものがあります。

| 状態 | 説明 |
|:--|:--|
|Foreground|アプリが起動して前面で表示中|
|Background|アプリが起動済みだがバックグラウンドか最小化されている|
|Quit|モバイル端末がロックされている、もしくはアプリがアクティブでないか実行されていない|

## 処理フロー

処理フローは以下になります。

### アプリの状態がForegroundの場合

![プッシュ通知受信時の処理フロー](receive-push-notification.drawio.png)

`onMessage`に設定したハンドラでプッシュ通知を受信するには、アプリの状態がForegroundである必要があります。
`onMessage`で通知を受け取ると、スナックバーで通知内容をアプリ上に表示します。データに応じた処理があれば行いますが、画面遷移などユーザの操作を妨げる処理は行わないこととします。

### アプリの状態がBackgroundの場合

![プッシュ通知タップ時(Background)の処理フロー](tap-push-notification-when-background.drawio.png)

アプリの状態がBackgroundの際にプッシュ通知を受信すると、通知領域に通知が表示されます。
通知をタップ時してアプリが前面表示した際に`onNotificationOpenedApp`に設定したハンドラが呼ばれるので、通知内容に応じた処理（画面遷移など）を行います。

### アプリの状態がQuitの場合

![プッシュ通知タップ時(Quit)の処理フロー](tap-push-notification-when-quit.drawio.png)

アプリの状態がQuitの際にプッシュ通知を受信すると、通知領域に通知が表示されます。
通知をタップ時してアプリを起動した際に、`getInitialNotification`で取得した通知内容に応じた処理（画面遷移など）を行います。
