---
title: ディープリンク
sidebar_label: Overview
---

ディープリンクを利用することで、情報共有の仕組みをアプリで作り込まずに、ユーザ間でURLを共有することで実現できます。

情報を共有する方法としては次のようなものがあります。
 1. 他のユーザから入力する情報を聞き、アプリケーション内で入力する
 1. URLをSNSやメール、QRコードで開きアプリケーションにわたす（ディープリンク）

アプリケーション内で入力するより、URLを開くだけで操作できる方がユーザ体験として好ましい場合にディープリンクを利用します。

ディープリンクの実現方式として[Firebase Dynamic Links](https://firebase.google.com/docs/dynamic-links)を利用した実現方式を記載します。

## 全体の構成

まずディープリンクの全体の構成を以下に示します。

ディープリンクのURLを開くと、下記の図のようにOSがアプリとURLの関連を検証します。
アプリケーションとURLが相互に関連を持っていることが検証できると対象のアプリケーションにURLを渡します。

アプリケーションとドメインの関連については[iOS](https://firebase.google.com/docs/dynamic-links/ios/receive)と[Android](https://firebase.google.com/docs/dynamic-links/android/receive)を参照してください。

SantokuAppではDynamic Linksを利用するため、破線で示す未インストール時の[フロー](https://firebase.google.com/docs/dynamic-links/operating-system-integrations)も実現しています。

![overview](./overview.drawio.png)

## 用語

ディープリンクのアーキテクチャで使用する用語をまとめています。

|用語|意味|備考|
|:--|:--|:--|
|ディープリンクのURL|ユーザをアプリ内の特定のコンテンツに直接誘導するURL|[Android App Links](https://developer.android.com/training/app-links)|
|URL|OSが関連を検証するHTTPS URLです。Dynamic Linksの場合、URLにリンクが含まれる|詳しくは[Firebase Dynamic Links](https://firebase.google.com/docs/dynamic-links/create-manually)を参照|
|リンク|アプリに渡されるHTTPS URLです。Dynamic Linksの場合、URLにリンクが含まれる|詳しくは[Firebase Dynamic Links](https://firebase.google.com/docs/dynamic-links/create-manually)を参照|
|リンクパラメータ|リンクにあるパラメータ|パラメータについては[URLの構成](./create-deep-link.mdx#URLの構成)の`link`を確認してください|
|ディープリンクで起動|アプリが非アクティブな状態でディープリンクを開いたときにアクティブになり、リンクを受け取ること||
|ディープリンクを受信|アプリがアクティブな状態でディープリンクを開き、リンクを受け取ること||
|ディープリンクの処理|アプリがリンクを受け取り、リンクをもとに処理すること||

### 利用するライブラリ

React NativeでFirebase Dynamic Linksを利用するために[React Native Firebase Dynamic Links](https://rnfirebase.io/dynamic-links/usage)を利用します。

React Native Linkingを利用してURLを受け取ることはできますが、URLからリンクにする機能がなく、未インストール時のフローに対応できません。

React Native Firebaseの導入については[React Native Fireabase](https://rnfirebase.io/)と[Dynamic Link](https://rnfirebase.io/dynamic-links/usage)を参照してください。

### ディープリンクのURLに対応するWebサイト

ディープリンクは[Android App Links](https://developer.android.com/training/app-links?hl=ja#app-links-vs-deep-links)でも説明されているようにWebサイトとモバイルアプリで同等の機能が提供されます。

> シームレスなユーザー エクスペリエンス: Android アプリリンクでは、ウェブサイトとアプリの同じコンテンツに単一の HTTP URL を使用するため、アプリをインストールしていないユーザーは、アプリではなく単にウェブサイトに移動します。404 などのエラーはありません。

本プロジェクトでは[Dynamic Linksの仕組み](https://firebase.google.com/docs/dynamic-links?hl=ja#how-does-it-work)を利用しWebサイトでは機能を提供しません。

また独自のカスタムドメインではなく`page.link`サブドメインを利用します。

### テスト

ディープリンクを利用した機能のテストをする場合、本番環境とは異なるサイトからインストールする必要があります。

ビルドバリアントの説明に沿った形式でFirebaseアプリとモバイルアプリを関連付けます。

SantokuAppではテストにはDeployGate、本番環境は公式のStoreで配信します。

- iOSでは利用するライセンスがことなるため`bundleId`の切り替えが必要です。
- Androidでは本番と異なる証明書（keystore）を利用します。

![テストと本番の設定](./test-setting.drawio.png)
