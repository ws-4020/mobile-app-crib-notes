---
title: ディープリンクの処理
---

ディープリンクURLをアプリケーションで処理する方法について記載します。

## アプリケーションの状態とディープリンクURLの取得

アプリがディープリンクURLを取得するための[API](https://rnfirebase.io/dynamic-links/usage#listening-for-dynamic-links)は次の2つがあります。

- ディープリンクによりアプリがアクティブになった場合は[getInitialLink](https://rnfirebase.io/reference/dynamic-links#getInitialLink)でディープリンクURLを取得します。
- アプリがアクティブなときにディープリンクURLを開いた場合は[onLink](https://rnfirebase.io/reference/dynamic-links#onLink)でディープリンクURLを取得します。

どちらの場合でもディープリンクURLからコンテンツリンクを取得し、画面遷移を判定して、リンクのパラメータを処理します。コンテンツリンクのパラメータは[ディープリンクURLの構成](./create-deep-link.mdx#ディープリンクURLの構成)にあるとおり、スクリーンとパラメータを受け取ります。

[Universal Linksの警告](https://developer.apple.com/documentation/xcode/supporting-universal-links-in-your-app)にもあるようにディーリンクのパラメータは外部入力として構成に合致するか検査し、ユーザに情報を表示するなど安全なアクションにとどめてください。

### リンクパラメータの保持

リンクパラメータをアプリケーションが取得したとき、（認証が必要など）すぐに処理するページに遷移できないケースがあります。

リンクパラメータをアプリケーションステートで保持してしまうと、クリアするタイミングなどの設計が難しくステートの管理が煩雑になります。

そのため、リンクパラメータを引き継ぐ範囲を決めてナビゲーションのパラメータとして次の画面へわたすよう設計してください。

:::note
[<u>ユーザー エクスペリエンスを向上させる</u>](https://developer.android.com/training/app-links/deep-linking#handling-intents)でも記載されているようにディープリンクから該当のページへの遷移までに多くの画面をまたがないことが好ましいです。
:::

### iOS14以降でのクリップボード利用の通知

iOSではインストール直後にアプリケーションへURLを渡すためにクリップボードを利用します。この機能のため、アプリケーションは初回起動時のみクリップボードの値を読み込みます。

iOS14以降ではクリップボードを読み取るとOSが通知を表示する仕様となっています。そのため、初めてアプリケーションを起動したときのみ、クリップボードに値が存在していると、「`<アプリ名>にSafariからペースト`」のような通知が表示されます。

設定により[クリップボードを無効にする](https://firebase.google.com/docs/dynamic-links/ios/receive?hl=ja#set-up-firebase-and-the-dynamic-links-sdk)こともできますが、インストール後にディープリンクURLを読み取る機能が利用できません。[^1]
そのため、このユーザへの通知は制限事項としています。

:::note
初回起動時のクリップボードの読み取りは、ドメインが一致するディープリンクURLであれば読み取ります。
ただし、起動したときのディープリングURLが優先されるため、クリップボードから読み取ったという通知は出ますが、クリップボードの値は利用されません。
:::
