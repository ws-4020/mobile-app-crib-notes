---
title: ディープリンクの処理
---

ディープリンクをアプリケーションが受信するタイミングは2つあります。ユーザがアプリを起動していない状態でディープリンクから起動した場合とアプリが起動中の場合です。

## アプリケーションの状態とURLの取得

アプリがURLを取得するための[API](https://rnfirebase.io/dynamic-links/usage#listening-for-dynamic-links)は[ディープリンクで起動](#ディープリンクで起動)した場合と[ディープリンクを受信](#ディープリンクを受信)した場合があります。

どちらの場合でもURLからリンクを取得し、画面遷移の判定をした上でリンクのパラメータを処理します。

リンクのパラメータは[URLの構成](./create-deep-link.mdx#URLの構成)にあるとおり、スクリーンとパラメータを受け取れます。

### 推奨事項

認可が必要な情報を共有する場合は、情報自体をURLに含めず、取得するためのパラメータをURLに含めディープリンクを受け取ったアプリケーション内で（認証したうえで）情報にアクセスします。

また、リンクパラメータを利用してユーザの情報入力を保管することにとどめます。リンクパラメータを読み取りアプリケーションがユーザに通知せずにデータの変更をしないようにしてください。

### ディープリンクで起動

ディープリンクでアプリがアクティブになった場合は[getInitialLink](https://rnfirebase.io/reference/dynamic-links#getInitialLink)でリンクを取得します。

### ディープリンクを受信

アプリがアクティブなときにディープリンクを開いた場合は[onLink](https://rnfirebase.io/reference/dynamic-links#onLink)でリンクを取得します。

### リンクパラメータの保持

リンクパラメータをアプリケーションが取得したとき、（認証が必要など）すぐに処理するページに遷移できないケースがあります。

リンクパラメータをアプリケーションステートで保持してしまうと、クリアするタイミングなどの設計が難しくステートの管理が煩雑になります。

そのため、リンクパラメータを引き継ぐ範囲を決めて画面遷移時にパラメータとして次の画面にわたすように設計してください。

### iOS14以降でのクリップボード利用の通知

iOSではインストール直後にアプリケーションへURLを渡すためにクリップボードを利用します。この機能のため、アプリケーションは初回起動時のみクリップボードの値を読み込みます。

iOS14以降ではクリップボードを読み取るとOSが通知を表示する仕様となっています。そのため、初めてアプリケーションを起動したときのみ、クリップボードに値が存在していると、「`<アプリ名>にSafariからペースト`」のような通知が表示されます。

[クリップボードを無効にする](https://firebase.google.com/docs/dynamic-links/ios/receive?hl=ja#set-up-firebase-and-the-dynamic-links-sdk)こともできますが、[iOSの他のユーザのURLを読み取る課題](./ios-patch.mdx#他のユーザが受け取ったURLを読み取る可能性)に対応するため、インストール後もURLを読み取る機能が利用できなくなります。
そのため、このユーザへの通知は制限事項としています。

:::note
初回起動時のクリップボードの読み取りは、ディープリンクでアプリを起動した場合でも形式（`https://関連付けたドメイン`）であれば読み取ります。
ただし、起動したときのディープリングが優先されるため、iOS14以降ではクリップボードから読み取ったという通知は出ますが、クリップボードの値は利用されません。
:::
