---
title: React Native Firebaseの対応
---

React Native Fireabaseで発生する2つの課題に対応します。

 - iOSアプリで他のユーザが開いたディープリンクURLを読み取っていないか検証できない
 - iOSアプリでアプリ起動の時間が短いとディープリンクURLを取得できない

## 他のユーザが開いたディープリンクURLを読み取る可能性がある

iOSではアプリが受け取ったディープリンクURLをユーザが開いたものかどうかを判定するために[matchType](https://firebase.google.com/docs/reference/swift/firebasedynamiclinks/api/reference/Enums/DLMatchType.html)という項目があります。

このmatchTypeの値が`unique`でない場合は誤って受け取ったディープリンクURLである可能性があるため、アプリケーションでこのURLは利用しません。

ただし、React Native Firebase Dynamic Linksでは、matchTypeをJavaScript Moduleに渡していないため、アプリケーションが参照できません。
そのためReact Native Firebase Dynamic Linksに[patch-package](https://www.npmjs.com/package/patch-package)でパッチを適用し、判定できるようにします。

## アプリ起動の時間が短い場合にディープリンクURLを取得できない

iOSアプリではアプリ起動の時間が短いとディープリンクURLを取得できない[issue](https://github.com/invertase/react-native-firebase/issues/2660)があります。このissueに対応するため、`getInitialLink`ではなく、React Native Linkingの[`getInitialURL`](https://reactnative.dev/docs/linking#getinitialurl)を利用します。

React Native LinkingはコンテンツリンクURLではなくディープリンクURLが取得されるため、[resolveLink](https://rnfirebase.io/reference/dynamic-links#resolveLink)を利用してコンテンツリンクURLを取得します。

:::note
Androidアプリでは[React Native Linkingにissue](https://github.com/facebook/react-native/issues/25675)があるため、iOSのみReact Native Linkingを利用します。
:::
