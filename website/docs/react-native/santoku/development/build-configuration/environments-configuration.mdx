---
title: 環境の切り替え
---

## 環境の種類

このアプリでは、用途に応じて以下の環境を用意しています。

| 環境 | 概要 |
|:--|:--|
| local | ローカル環境で開発する際に使用します。 |
| stg | ステージング環境のアプリを配信する際に使用します。この環境でビルドしたアプリはDeployGateにアップロードして配信されます。 |
| prod | 本番環境のアプリを配信する際に使用します。この環境でビルドしたアプリはApp StoreやGoogle Play Consoleにアップロードして配信されます。|

## 環境の切り替え方法

ExpoのPrebuildには、環境ごとにExpo configの設定を切り替える機能はありません。
そのため、Prebuild時にビルドする環境を変数として渡し、その値によって使用する設定を切り替えるようにします。

例えば、ステージング環境のアプリをビルドする場合は、環境変数`ENVIRONMENT`に`stg`を指定してPrebuildを実行します。

```bash
ENVIRONMENT=stg npx expo prebuild
```

Expo configでは、環境変数`ENVIRONMENT`の値によって使用する設定を切り替えます。

```javascript title=app.config.js
import localConfig from './config/app.config.local.js';
import prodConfig from './config/app.config.prod.js';
import stgConfig from './config/app.config.stg.js';
import {
  withAddAppActivity,
  withEnabledStatusBarTranslucent,
  /* ～省略～ */
} from './config/app.plugin.js';

const environmentConfig = {
  local: localConfig,
  stg: stgConfig,
  prod: prodConfig,
};

module.exports = ({config}) => {
  const environment = process.env.ENVIRONMENT ?? 'prod';
  const defaultAppConfig =  {
    ...config,
    name: 'SantokuApp',
    version: '0.1.0',
    orientation: 'portrait',
    /* ～省略～ */
    android: {
      package: 'jp.fintan.mobile.SantokuApp',
      /* ～省略～ */
    },
    ios: {
      bundleIdentifier: 'jp.fintan.mobile.SantokuApp',
      /* ～省略～ */
    },
    extra: {
      santokuAppBackendUrl: 'http://localhost:8080',
      mswEnabled: true,
      /* ～省略～ */
    },
    plugins: [
      /* ～省略～ */
      // このアプリで用意しているプラグイン
      withAddAppActivity,
      withEnabledStatusBarTranslucent,
      /* ～省略～ */
    ],
    /* ～省略～ */
  };
  return {...defaultAppConfig, ...environmentConfig[environment](defaultAppConfig)};
};
```

```javascript title=app.config.stg.js
const withAppBuildGradleForRelease = require('./app.plugin.js').withAppBuildGradleForRelease;
/* ～省略～ */

module.exports = config => {
  return {
    ...config,
    name: 'Stg SantokuApp',
    android: {
      ...config.android,
      package: 'jp.fintan.mobile.SantokuApp.stg',
      /* ～省略～ */
    },
    ios: {
      ...config.ios,
      bundleIdentifier: 'jp.fintan.mobile.SantokuApp.stg',
      /* ～省略～ */
    },
    extra: {
      ...config.extra,
      santokuAppBackendUrl: 'https://santoku-app-backend.azurewebsites.net',
      /* ～省略～ */
    },
    plugins: [
      ...config.plugins,
      // このアプリで用意しているプラグイン
      withAppBuildGradleForRelease,
      /* ～省略～ */
    ],
  };
};
```
