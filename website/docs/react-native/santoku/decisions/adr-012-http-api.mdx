---
title: HTTP API通信に関する方針
---

Status: Proposed

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

## コンテキスト

:::note
ReactによるHTTP API通信の課題を書く。
React公式ドキュメントの[パフォーマンス最適化](https://ja.reactjs.org/docs/hooks-faq.html#performance-optimizations)に紹介されている[記事(How to fetch data with React Hooks)](https://www.robinwieruch.de/react-hooks-fetch-data/)の内容がそのまま課題になるはず。
Reactフックでデータを正しくフェッチする場合、次の考慮が必要。

- データ取得タイミングの制御
- 非同期処理に対する考慮
  - 非同期処理の状態（初期状態・ローディング）管理
  - エラーハンドリング
  - コンポーネントの状態による処理のキャンセル

こういった定型処理を各画面毎に実装するとボイラープレートコードが増えるため共通化が必要。
また、上記に加え、次の機能についても考慮が必要。

- バックエンドデータの管理
  - バックエンドデータはサーバーの状態
    - サーバーの状態とクライアントの状態は根本的に異なる
  - バックエンドデータのフェッチと更新には非同期APIでの処理が必要
  - クライアントで制御できないリモートに永続化される
  - 知らないうちに他の人により変更される
  - アプリのライフサイクル中に「古くなり」または「時代遅れ」となる
- キャッシング
  - ページングや無限スクロールへの効率的な対応として必要
- オフラインへの考慮
  - このアプリでは対応しないが

このような課題を解消するための技術選定が必要。
:::

## 議論

### HTTP API通信実装に向けた技術選定

:::note
いくつかの案に対する技術選定

- Redux
  - Reduxによる解決はしない理由を記述
    - 比較的難易度が高い方式。今はContextなどを用いた代替方法もある
    - Reduxの管理主体はグローバルなクライアント状態と考える。バックエンドデータ管理としてはローカルな状態管理のみでいい場合もあり、キャッシュなどのモチベーションとしてReduxを用いるのは適切ではない。
    - Reduxで本格的に非同期処理を扱う場合は`redux-thunk`や`redux-saga`の導入も必要となり大変
    - 記述が分断されて処理を追うのが大変
- React Query
- 他の選択肢としてはSWRくらいが妥当？

[React Query公式が用意した比較資料](https://react-query.tanstack.com/comparison)も参考にする

選定基準は次くらいを考えている。

- コード記述量
- HTTP クライアントを選ばない
  - GraphQLなどにも対応してほしい
- ライセンス
- 人気
- 開発母体（個人かどうかなども）
- サイズ
  - React Nativeの場合はあまり考慮しなくてもよさげ

:::

### React Queryが提供する機能群

:::note
React Queryが提供する代表的な機能の紹介する？
全部は紹介せず代表的な次くらい。

- キャッシュ
	- 古いデータの管理
	- キャッシュ期間の管理
- 依存性管理
- ページング
- 無限スクロール
- 更新系

:::

### React Queryの設定項目とデフォルト値

:::note
- React Queryの設定項目の簡単な説明とデフォルト値について
- アプリで変更するデフォルト設定
- cacheTimeとstaleTimeの説明はあったほうがいい？
:::

### 開発方針

#### Reqct Queryを用いた開発方針

:::note
- 共通処理のためのラッパーフックを作る？
- cache毎にフックを作るのはよさげ
- データ更新時のキャッシュの扱いを調査
:::

#### バックエンドAPIの定義について

:::note
- ページネーションの方法
  - リクエスト
    - Spring Bootの方法にあわせておけばいいかな？
  - レスポンス
    - RFC-5988かRFC-8288あたりを参考に
  - 参考URl
    - https://docs.spring.io/spring-data/rest/docs/3.7.x/reference/html/#paging-and-sorting
    - https://gist.github.com/bernardolopes8/cf04f49e1b64bd47576e7204601ef126
:::

#### エラーハンドリング

:::note
エラーハンドリング方針など
:::

## 決定
