---
title: HTTP API通信で発生するエラーのハンドリング
---

Status: Accepted

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

:::note
ADRの決定事項を要約して、3行程度で記載してください。
:::

## コンテキスト

モバイルアプリがHTTP APIと通信する際は、以下のようなエラーが発生する可能性があります。

* HTTPステータスコードが4xx
* HTTPステータスコードが5xx
* HTTP APIの応答に時間がかかってしまい、通信がタイムアウト
* モバイル端末のネットワークがOFFになっていて通信ができない

ここでは、どのようなエラーの場合に共通処理としてエラーのハンドリングを行い、どのような場合に個別処理として実施する必要があるのかを検討します。また、エラーが発生した場合にリトライ処理を実施するかなどについても検討していきます。

## 議論

### エラーハンドリングするステータスコード

HTTP APIとの通信時には、処理が失敗した場合にHTTPステータスコードが400以上のレスポンスが返却されます。返却される主なHTTPステータスコードは以下になります。

| HTTPステータスコード | 意味                                                                              |
| :---------------- | :------------------------------------------------------------------------------- |
| 400               | BadRequest - リクエストとして送るペイロードがバリデーションエラーになった場合など             |
| 401               | Unauthorized - 認証トークンの期限が切れた場合                                          |
| 403               | Forbidden - リソースへのアクセス権限がない場合                                          |
| 404               | Not found - リソースが見つからなかった場合                                             |
| 405               | Method Not Allowed - メソッドがサポートされていない場合                                 |
| 406               | Not Acceptable - リクエストで送信したAcceptヘッダに準拠したレスポンスを返すことができない場合  |
| 408               | Request Timeout - リソース待ちでHTTP APIがタイムアウトする場合                           |
| 409               | Conflict - リクエストが競合した場合                                                   |
| 410               | Gone - リソースが既に存在しない場合                                                    |
| 412               | Precondition Failed - 操作しているモバイルアプリケーションが強制アップデート対象の場合        |
| 415               | Unsupported Media Type - ペイロードがサポートされていないフォーマットの場合                |
| 429               | Too Many Requests - クライアントから大量のリクエストが送信された場合                       |
| 500               | Internal Server Error - サーバで予期しないエラーが発生した場合                           |
| 503               | Service Unavailable - HTTP APIがシステムメンテナンスで止まっている場合                   |
| 504               | Gateway Timeout - HTTP APIから時間内に応答がなかった場合                               |

## 決定

:::note
最終的な決定内容を記録してください
:::
