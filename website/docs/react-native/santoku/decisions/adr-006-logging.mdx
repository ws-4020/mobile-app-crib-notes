---
title: ログ出力の方針
---

Status: Accepted

## 要約

:::note
ADRの決定事項を要約して、3行程度で記載してください。
:::

## コンテキスト

次の観点からログ出力に必要な機能を議論し、基盤部品として提供するログ出力方式、およびログ出力ライブラリの仕様を決定します。

- ログ出力の用途
- ログ出力に必要な機能
  - ログレベル
  - ログフォーマット
  - ログ収集
    - 収集タイミング
- ログメッセージに含める内容
  - 日時
  - アカウントID
  - エラーコード
  - 起動ID
  - モジュール名
- サードパーティー・ライブラリを使用しない理由
- Firebase Crashlyticsを採用した理由
  - 収集タイミングや制限事項に伴う注意事項

## 議論

### ログ出力の用途

ログ出力の用途としては次のものが考えられる。

- デバッグ用途（プログラム処理の追跡など）
- システム状態の把握
- エラー発生時の障害解析
- パフォーマンス分析
- ユーザ操作の把握・分析
- セキュリティおよび不正防止のための監査・証跡、および証拠能力

今回のログ出力機能の主要用途は次をターゲットとする。

- デバッグ用途（プログラム処理の追跡など）
- エラー発生時の障害解析

次の用途をターゲットにしない理由としては、ログの収集と分析が必要
収集するためにトランスポートを複数指定できる口は設けておく

- システム状態の把握
- パフォーマンス分析
- ユーザ操作の把握・分析

モバイル端末ログとして保守するものではないし、機密情報を端末に保持すべきではない。

- セキュリティおよび不正防止のための監査・証跡、および証拠能力


### ログ出力に必要な機能

- ログ出力用途に応じたログレベルの設定と、開発や本番運用時などの状況に応じた出力範囲の切り替え

今回はデバッグとエラーのレベルしか必要ないが、ログの収集と分析のため拡張性を考慮して、一般的にログレベルを用意する。

- ログフォーマット形式の指定

デバッグ用途を考えると、日時は出力したい。
それ以外のアプリの背景によって出したい項目が変わるので、柔軟に対応できるようにログフォーマットを指定できるインタフェースを用意。

- ログ収集先の切り替え
  - 収集したログの確認方法

収集先を指定できるトランスポート機能を追加（複数指定可能）するので、それで対応することとする。
収取先としてはFirebase Crashlyticsをデフォルトで用意。
リリースビルドのエラーログの場合だけ収集する。
その理由としては、Firebase Crashlyticsを使う上での注意事項はリンクを参照のこと。

### ログメッセージに含める内容

ログコンテキストを用意してキーバリューで設定できるようにする。
ログフォーマットで参照できる。

ただし、アプリクラッシュ時にFirebase Crashlyticsに送信するログ情報には含まれないので、別途設定が必要。

### サードパーティー・ライブラリを使用しない理由

メッセージと同様。

### Firebase Crashlyticsを採用した理由

プッシュ通知でFirebaseを使うから。
モバイルアプリのmBaaSとしてFirebaseが主流の一つだから

## 決定

:::note
最終的な決定内容を記録してください
:::
