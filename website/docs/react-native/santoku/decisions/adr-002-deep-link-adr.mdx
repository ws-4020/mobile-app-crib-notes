---
title: ディープリンク
---

Status: Proposed

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

T.B.W

## コンテキスト

招待コードや一時的なTokenをユーザ間で共有してもらう場合、次のいずれかの方法が考えられます。

- ガイドや操作方法を教えてもらい、アプリをインストールしてから、アプリを起動し該当ページに移動してコードを入力する。
- SNSやQRコードなどで共有されたURLを開き、アプリをインストールし起動する。（起動すると該当ページで入力済みになっている）

後者のほうが入力の間違いもなくユーザの操作が少ないため、アプリのユーザ体験を向上することが期待できます。

## 議論

共有されたURLからアプリケーションに情報を渡す方法として3つの方法があります。

 - OSの機能（Universal Links、Android App Links）を直接利用する
 - FirebaseのDynamic Linksを利用する
 - カスタムURLスキームを利用する

まずカスタムURLスキームは招待コードやTokenを渡す用途では回避できないセキュリティのリスク（※1）があるため採用できません。

「OSの機能を直接利用する」場合でも「FirebaseのDynamic Linksを利用する」場合でも設定する内容自体は大きく変わりません。

設定する作業はFirebaseが簡単ですが、静的なWebサイト上でドメインと関連付けのためにファイルを配置するだけでそこまで大きな差はありません。

Firebse Dynamic LinksとOSの機能を直接利用する場合の違いは以下のとおりです。

|観点|Dynamic Links|OSの機能|
|:--|:------------|:------|
|アプリへの誘導|○|☓|
|設定ファイル|△|○|
|環境の切り分け|△|○|
|セキュリティ|○|○|

設定ファイルの管理に関して考慮する必要がありますが、他の機能でFirebaseを導入する前提であれば同じ考慮が必要なため、Dynamic Linksを採用します。

※1: カスタムURLスキームは自由に設定できるため、作成したURLを別のアプリが乗っ取ることができます。

### アプリへの誘導

アプリの統合の説明を簡単に記載する。

クリップボードを利用することを記載する。

### 設定ファイル

Dynamic LinksでもOSの機能でもアプリケーションにドメインとの関連付けが必要になります。

Dynamic Linksを利用する場合のみGoogleServiceの設定ファイルが必要です。この設定ファイルを開発者毎にするとなると管理が煩雑になります。（とくにiOSでの開発は個人開発者アカウントを利用してもらいためBundleIdが変わっていまいます。）

実際に必要になるものは環境毎（たとえば、開発、外部テスターなどのステージング、本番）設定ファイルです。（これはFirebase Crashlyticsも同様なため、Firebaseを導入するのであれば、設定ファイルを準備することはコスト増にはなりません。）

GoogleService-info.plistにあるbundleIdとアプリケーションのbunndleIdは一致させる必要がないため
個人開発者アカウントを利用する場合にアカウント毎にアプリの作成は不要です。そのため、開発者が増えるたびに手続きが増えるような問題はありません。

一方でAndriodアプリケーションは`pakcage_name`を一致させる必要がありますが、開発者毎に切り替える必要はないためiOSと同様に3ファイル程度あれば問題ありません。

### 環境の切り分け

OSの機能を利用したディープリンクだけであれば、本番のドメインと開発用のドメインを分ける必要はありません。

### セキュリティ

カスタムURLスキームとは異なり、アプリケーションとURLの正当性を検証しているため、情報を他のアプリにわたすことはありません。

:::note
解決方法や選択肢について検討・議論した内容を記録してください。
:::

## 決定

T.B.W

:::note
最終的な決定内容を記録してください
:::
