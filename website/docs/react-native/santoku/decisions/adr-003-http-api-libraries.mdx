---
title: HTTP API通信で使用するライブラリ
---

Status: Accepted

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

:::note
ADRの決定事項を要約して、3行程度で記載してください。
:::

## コンテキスト

React Nativeを使用したモバイルアプリでは、HTTP APIクライアントとして[Fetch API](https://developer.mozilla.org/ja/docs/Web/API/Fetch_API)や、[Frisbee](https://github.com/niftylettuce/frisbee)、[axios](https://github.com/axios/axios)などの[XMLHttpRequest API](https://developer.mozilla.org/ja/docs/Web/API/XMLHttpRequest)に依存したサードパーティのライブラリも使用可能です。
ここでは、それらのライブラリをいくつかの観点で比較して、使用するHTTP APIクライアントを決定します。

また、HTTP APIと通信する際は、エラーのハンドリングやローディング中などの状態を管理する必要があります。そういった課題に対応するために、[React Query](https://react-query.tanstack.com/overview)などのライブラリを使用することも検討していきます。



## 議論

### HTTP APIクライアントの選定

React Nativeを使用したモバイルアプリで使用可能なライブラリとしては、Fetch APIやFrisbee、axios、superagentなど多くのライブラリが存在します。その中で、チームメンバーが使用した経験が多いのはFetch APIとaxiosでした。そのため、まずはFetch APIとaxiosの2つに絞って比較していきます。

Fetch APIとaxiosは非常に有名で、OSS、商用利用問わず多くのアプリケーションで使用されています。チームメンバーが過去に開発したアプリでも安定して動作しており、安定性やパフォーマンスなどの観点において双方とも問題なさそうです。ドキュメントも充実しており、学習コストはさほど高くありません。ライセンスは双方ともMITライセンスになります。[^1]

[^1]: Fetch APIは、React Nativeに組み込まれているため、React Nativeのライセンスを表記しています。

そのため、ここではFetch APIとaxiosが「SantokuAppで必要としている要件を満たしているか」を観点として比較します。

現時点のSantokuAppでHTTP API通信に必要な要件は以下になります。

| 要件 | Fetch API | axios |
| :-- | :--------- | :---- |
| 各種HTTPメソッドのサポート | ○ | ○ |
| HTTP API通信のタイムアウト | △[^2] | △[^2][^3] |
| HTTP API通信のキャンセル | ○ | ○ |

[^2]: HTTP API通信をタイムアウトする機能はないですが、HTTP API通信のキャンセル機能を使えば実現可能です。
[^3]: axiosでは[timeout](https://github.com/axios/axios#request-config)を設定できます。ただし、axiosの`timeout`はAndroidではコネクションタイムアウトのみに使用されるため、コネクション接続後にサーバの応答が遅い場合などはタイムアウトしません。

ほとんど差はなく、採用の決め手になる要因はありませんでした。

しかし、現時点の要件としてはありませんが、今後ファイルのアップロード機能が追加された場合は差が出てきそうです。axiosは、アップロード中の進捗状況を取得できます。アップロード中の進捗状況を取得できると、プログレスバーなどで視覚的にアップロード状況を伝えることができます。

そのため、追加される可能性のある要件を見据えて、axiosを採用することにします。

## 決定

:::note
最終的な決定内容を記録してください
:::
