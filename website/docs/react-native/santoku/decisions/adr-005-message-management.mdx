---
title: モバイルアプリで使用するメッセージの取得先
---

Status: Accepted

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

SantokuAppでは、常にクラウドサービスに格納された最新のメッセージを取得します。

ただし、モバイル端末のネットワークがOFFなどの理由によりクラウドサービスからメッセージを取得できない場合は、モバイルアプリ内にバンドルされているメッセージを利用します。

## コンテキスト

モバイルアプリでは、様々な場面でダイアログやスナックバーを通してユーザにメッセージを伝えます。ユーザがモバイルアプリを操作中にエラーが発生した場合は、そのエラー内容や復旧手順をスナックバーに表示します。
モバイルアプリで表示している情報を変更する際などは、確認メッセージをダイアログに表示するようなケースもあります。

それらのメッセージの取得先として、大きく以下の2つが候補として挙がりました。

- アプリ内（バンドルされたファイルなどから取得）
- アプリ外（クラウドストレージやAPIなどから取得）

ここでは、メッセージを上記のどちらから取得するかについて検討します。

なお、アプリのビルド時に必要なメッセージは、アプリ内にバンドルする以外の方法はないため検討対象外とします。例えば、Push通知の許可ダイアログに表示するメッセージなどが該当します。

## 議論

メッセージをモバイルアプリ内にバンドルした場合は、メッセージを更新するために都度モバイルアプリをApp StoreやGoogle Playにリリースする必要があります。

その反面、メッセージをクラウドサービスに格納した場合は、アプリの起動時にクラウドサービスから全てのメッセージを取得することで、モバイルアプリをリリースしなくても常に最新のメッセージが利用できます。

:::caution
新たにメッセージを追加した場合は、追加されたメッセージを利用するプログラムの変更が必要です。その場合はモバイルアプリをApp StoreやGoogle Playにリリースする必要があります。
:::

ただし、以下のような場面ではクラウドサービスに格納しているメッセージを取得できない場合もあります。

- ユーザが操作する端末のネットワークがOFFの場合
- メッセージを格納したクラウドサービスがダウンしている場合

そういった場合のフォールバック手段として、モバイルアプリ内にもメッセージを格納します。クラウドサービスからメッセージを取得できない場合は、モバイルアプリ内にバンドルされたメッセージを利用します。

なお、モバイルアプリ内にバンドルされたメッセージは、常に最新のメッセージが取得できるとは限りません。[^1]それに関しては、SantokuAppの制限事項とします。

[^1]: クラウドサービスに格納されているメッセージを更新しても、モバイルアプリ内にバンドルされているメッセージは更新されないため、それら2つのメッセージが常に同期されているわけではありません。モバイルアプリ内にバンドルされているメッセージを最新化するには、モバイルアプリをApp StoreやGoogle Playにリリースする必要があります。

## 決定

SantokuAppで使用するメッセージの取得先は以下とします。

- クラウドサービスに格納されているメッセージを取得する
- クラウドサービスからメッセージを取得できない場合は、モバイルアプリ内にバンドルされているメッセージを取得する

なお、モバイルアプリ内にバンドルされているメッセージは常に最新のメッセージではない可能性がありますが、それに関してはSantokuAppの制限事項とします。
