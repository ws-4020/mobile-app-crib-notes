---
title: アプリで使用するメッセージの取得先
---

Status: Accepted

<!--
Proposed: 提案中
Accepted: 採用
Rejected: 却下
Superseded: 廃止
-->

## 要約

SantokuAppでは、常にAPIから最新のメッセージを取得します。

ただし、モバイル端末のネットワークがOFFなどの理由によりAPIからメッセージを取得できない場合は、アプリ内にバンドルされているメッセージを利用します。

## コンテキスト

モバイルアプリでは、様々な場面でダイアログやスナックバーを通してユーザにメッセージを伝えます。ユーザがアプリを操作しているときにエラーが発生した場合は、そのエラー内容や復旧手順をスナックバーに表示します。
アプリで表示している情報を変更する際などは、確認メッセージをダイアログに表示するようなケースもあります。

それらのメッセージの取得先として、大きく以下2つが候補として挙がりました。

- アプリ内（バンドルされたファイルなどから取得）
- アプリ外（APIなどから取得）

ここでは、メッセージを上記のどちらから取得するかについて検討します。

なお、アプリのビルド時に必要なメッセージは、アプリ内にバンドルする以外の方法はないため検討対象外とします。例えば、Push通知の許可ダイアログに表示するメッセージなどが該当します。

## 議論

メッセージをアプリ内にバンドルした場合は、メッセージを更新するために都度アプリをApp StoreやGoogle Playにリリースする必要があります。

その反面、メッセージをアプリ外に格納した場合は、アプリの起動時にAPIから全てのメッセージを取得することで、アプリをリリースしなくても常に最新のメッセージが利用できます。

:::caution
新たにメッセージを追加した場合は、追加されたメッセージを利用するようにプログラムを修正する必要があります。その場合はアプリをApp StoreやGoogle Playにリリースする必要があります。
:::

ただし、以下のような場面ではアプリ外に格納しているメッセージを取得できない場合もあります。

- ユーザが操作する端末のネットワークがOFFの場合
- メッセージを格納したAPIサーバがダウンしている場合

そういった場合のフォールバック手段として、アプリ内にもメッセージを格納します。APIからメッセージを取得できない場合は、アプリ内にバンドルされたメッセージを利用します。

なお、アプリ内にバンドルされたメッセージは、常に最新のメッセージが取得できるとは限りません。[^1]それに関しては、SantokuAppの制限事項とします。

[^1]: アプリ外に格納されているメッセージを更新しても、アプリ内にバンドルされているメッセージは更新されないため、それら2つのメッセージが常に同期されているわけではありません。アプリ内にバンドルされているメッセージを最新化するには、アプリをApp StoreやGoogle Playにリリースする必要があります。

## 決定

SantokuAppで使用するメッセージの取得先は以下とします。

- APIからメッセージを取得する
- APIからメッセージを取得できない場合は、アプリ内にバンドルされているメッセージを取得する

なお、アプリ内にバンドルされているメッセージは常に最新のメッセージではない可能性がありますが、それに関してはSantokuAppの制限事項とします。
