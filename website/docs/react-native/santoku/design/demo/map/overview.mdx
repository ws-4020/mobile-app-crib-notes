# マップ表示

## 概要

マップ表示を検証するデモページです。

![demo-map-page-1](./demo-map-page-1.png) ![demo-map-page-2](./demo-map-page-2.png)

このページのソースコードは[こちら](https://github.com/{@inject:organization}/mobile-app-crib-notes/tree/master/example-app/SantokuApp/src/features/demo-map)です。

## 検証できること

### 表示領域の変更

以下の項目に数値を入力し表示領域を変更できます。

- latitude: 緯度
- longitude: 経度
- latitudeDelta: 緯度範囲
- longitudeDelta: 経度範囲

### 地図の種類選択

以下の項目を設定し地図の見た目を変更できます。

- MapType: マップタイプ
  - standard: 道路地図
  - satelite: 航空写真
  - hybrid: 航空写真に道路地図を重ねたもの
- showBuildings: 建物の輪郭を表示

### 地図操作と制限できる項目の確認

以下の項目の操作を制限できます。

- scrollEnabled: スクロール操作による表示位置の移動
- zoomEnabled: ピンチイン・ピンチアウト操作とダブルタップによる拡大縮小
- rotateEnabled: 2本指スワイプによる回転
- pitchEnabled: 2本指上方向スワイプによる俯瞰視点の角度変更

### マーカーの操作（現時点で未実装）

- タップでコールアウトを表示
- マーカーの長押しからドラックアンドドロップで位置変更

### マーカーの追加（現時点で未実装）

- 緯度（テキスト入力）
- 経度（テキスト入力）
- タイトル（テキスト入力）
- 説明（テキスト入力）
- ドラックアンドドロップによる位置変更を許可するか（トグルボタン）

タイトルと説明を両方入力しなかった場合、タップしてもコールアウトは表示されません。

## 使用したマップSDK

地図表示のためにreact-native-mapsを使用します。
react-native-mapsで使用できるマップSDKは、iOSが[MapKit](https://developer.apple.com/documentation/mapkit/)あるいは[Google Map](https://developers.google.com/maps/documentation/ios-sdk?hl=ja)、Androidは[Google Map](https://developers.google.com/maps/documentation/android-sdk?hl=ja)のみになります。
このページではiOSはMapKit、AndroidはGoogle Mapを使用した地図表示を実装しています。

### Google Mapを使用する場合に必要な設定

Google Map APIが必要になります。
ソースコードの`app.config.js`にはダミーのAPIキーを入れています。
以下を参考にAPIキーを取得してください。

- [Google Map Platform API キーを使用する（Android）](https://developers.google.com/maps/documentation/android-sdk/get-api-key?hl=ja)
- [Google Map Platform API キーを使用する（iOS）](https://developers.google.com/maps/documentation/ios-sdk/get-api-key?hl=ja)

手元でAndroidの動作確認を行うときは個人で取得したGoogle Map API keyを用いました。

### iOSでGoogle Mapを使用するときの注意点

Santokuアプリではfirebaseを使用しているため、useFrameworksで静的リンクを明示的に指定しています。

- [Configure Firebase with iOS credentials](https://rnfirebase.io/#altering-cocoapods-to-use-frameworks)

しかしreact-native-mapsの0.3系はuseFrameworksに対応していません。
iOSでGoogle Mapを使用する設定でビルドしたとき依存関係にあるファイルが見つからないというエラーが発生しました。

- ['RCTConvert+AirMap.h' file not found](https://github.com/react-native-maps/react-native-maps/issues/3597)
- [use_frameworks! issues with react-native-maps RN 0.69.3](https://github.com/react-native-maps/react-native-maps/discussions/4389)

そのため['RCTConvert+AirMap.h' file not found](https://github.com/react-native-maps/react-native-maps/issues/3597)を参考にして、`Podfile`に以下を追記し動作確認を行いました。

```Ruby
  # https://github.com/react-native-maps/react-native-maps/issues/3597
  $static_framework = [
    'react-native-maps',
    'react-native-google-maps',
    'Google-Maps-iOS-Utils',
    'GoogleMaps',
  ]

  pre_install do |installer|
    Pod::Installer::Xcode::TargetValidator.send(:define_method, :verify_no_static_framework_transitive_dependencies) {}
        installer.pod_targets.each do |pod|
            if $static_framework.include?(pod.name)
                def pod.build_type;
                Pod::BuildType.static_library # >= 1.9
            end
        end
    end
  end
```
