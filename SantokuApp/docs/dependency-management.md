# 依存パッケージの管理について

## 依存パッケージの追加

次の3つのコマンドをセットで実行してください。

* `npm install <package-name>`
* `expo upgrade`
* `npm run pod-install`

ExpoはReactなど一部の依存パッケージについて、利用できるバージョンを管理しています。そういったライブラリについては、個別に自分たちで依存ライブラリのバージョンを管理する必要はありません。`expo upgrade`を実行すれば、適切なバージョンに更新されます。

一方で、`npm install <package-name>`でインストールするだけでは正しいバージョンでインストールされない可能性があるということに注意してください。

依存パッケージを追加した場合は、**必ず`expo upgrade`を実行**してください。

## 依存パッケージのバージョン管理

依存パッケージのバージョン管理にあたって、まず「`expo upgrade`の対象になるか」を確認します。そのうえで、指定するバージョン範囲をどう指定するかを決める必要があります。

このリポジトリでは次のように設計しています。具体的な分類については、[renovate.json5](../../.github/renovate.json5)を参照してください。

* `expo upgrade` に含まれるパッケージ
  * バージョン範囲の指定については `expo upgrade` での更新に任せる
* `expo upgrade` に含まれるパッケージへの依存があるパッケージ
  * 依存するパッケージのバージョン範囲に合わせる
* それ以外（なるべく `npm install` で更新できるようにまとめる）
  * `dependencies`: パッチバージョン (`~1.1.0`)
  * `devDependencies`: マイナーバージョン (`^1.1.0`)

### `@types`のバージョンについて

`@types`のバージョン範囲を指定するのはとても難しいです。このリポジトリでは、できるかぎり元パッケージの範囲指定に合うように設定しています。

元パッケージと同じやそれ以降のバージョンの`@types`パッケージがあるとは限らないので、元パッケージと同じバージョン範囲を指定するわけには行きません。たとえば、Reactのバージョンが`16.13.1`なのに`@types/react`では`16.9.x`しかありません。

このようなときにもできるだけ適切なバージョンの`@types`をインストールするために、`@types`のバージョン範囲指定には`^`や`~`ではなく、不等号（`<`）を利用しています。なお、`expo upgrade`に含まれるパッケージはこのルールには含めません。

* 例： `"jest": "^25.2.0"`
  * ▶ `@types/jest` はメジャーバージョンが25なら問題ないとして、 `"@types/jest": "<26.0.0"` と指定する
* 例： `react-test-renderer`
  * ▶ `jest-expo`では、`react-test-renderer`のバージョンを`~16.11.0`と指定している（`expo 40.0.0`時点）
  * ▶ `@types/react-test-renderer` はパッチバージョンが25なら問題ないとして、 `"@types/react-test-renderer": "<16.12.0"` と指定する
